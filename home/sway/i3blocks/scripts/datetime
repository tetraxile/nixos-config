#!/usr/bin/env nu

const timezones = [
  "US/Pacific" "US/Mountain" "US/Central" "US/Eastern" "Europe/Berlin" "Asia/Tokyo" "Australia/Melbourne"
];

let current_tz = $env | get -o current_tz | default 0 | into int;
mut btn = $env | get -o button | default (-1) | into int;
let offset = match $btn {
  2 => 1,
  3 => -1,
  _ => 0,
};

let current_tz = if $btn == 1 { 1 } else { ($current_tz + $offset) mod ($timezones | length) };
let tz = $timezones | get $current_tz;
let date = date now | date to-timezone $tz.1;
let current_time = $date | format date "%a %B %d %G %T";

{
  full_text: $"($current_time) ($tz.0) ($date | format date "UTC%:::z")",
  current_tz: $current_tz
} | to json | print
